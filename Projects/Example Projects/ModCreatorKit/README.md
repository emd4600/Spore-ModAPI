# ModCreatorKit

The `ModCreatorKit` adds a bunch of cheats and utilities that are useful to modders, such as the Effects Editor, the Animation Editor, the thumbnail capture cheat,...
You can download a compiled version here: https://github.com/emd4600/Spore-ModCreatorKit/releases/download/v1.2.0/ModCreatorKit.sporemod

It requires the latest version of the ModAPI DLLs ensure you have the [Launcher Kit](http://davoonline.com/sporemodder/rob55rod/ModAPI/Public/) up-to-date.

## Developer Cheats
The ModCreatorKit has many useful cheats, many of them hidden cheats used by Spore developers:
 - `devRaid`
 - `devSpace`
 - `devBadge`
 - `devMission`
 - `devAri`
 - `devBake`
 - `devRTT`
 - `devApp`
 - `devEffects`
 - `devEffect`
 - `devTerraform`
 - `devViewMgr`
 - `devStarMgr`
 - `devGtn`
 - `devOTDB`
 - `devPollen`
 
Most of these cheats were unused leftovers in the Spore code, so they are not
added as conventional cheats; instead, we forcefully add a cheat stored at
a certain address in code.

There are some cheats that we created ourselves:
 - `devContext`: Just switches the game mode to whatever the player says. 
 Very simple implementation using the `GameModeManager`.
 - `devAnimLog`: When enabled, the ID of all animations loaded will be printed
 to the console. To do this, we've had to detour the function that loads
 `.animation` files.
 - `devLogUI`: When enabled, the ID of all UI layouts loaded will be printed to the console.
 - `devInspectUI`: After executing it, click on a UI element in the screen, and it will print the control ID of that UI window. Additionally, if you compiled the ModCreatorKit yourself, it will trigger a breakpoint where you can debug and explore that UI window.
 - `devPackage`: When executed without arguments, it shows the paths to all databases (i.e. `.package` files) that are loaded, which is all the places where Spore looks for files. You can also specify a file key, and then it will show from which database Spore would read that file.
 
## File Debugging

Another feature of this mod is **file debugging**: the ability of changing certain mod files without having to repack
the mod. Not all files work with this, since some have to be converted (such as `.prop` files) and others are cached by Spore (such as textures).

To enable it, you have to click "Pack mod with debug info" on your SporeModderFX mod. THen open the game (with ModCreatorKit installed, of course!), and you'll be able to edit some files with the game open. This is very useful for designing parts: just reexport a `.rw4`, and then the next time you place the part it will be the updated model.

![](https://i.imgur.com/aNlUU1r.png)

#### Implementation details
We've implemented this by detouring the function that opens a file from a `.package` file: if that package has a certain
"debugging information" (basically file paths) that SporeModderFX has packed, instead of opening the file in the `.package` we will
find the file in the disk.
 
## Effects Editor

This mod also adds a new game mode and a cheat to access it, `effectsEditor`. This can be used with SMFX to test and edit effects 
in real time, [check the tutorial](https://github.com/emd4600/SporeModder-FX/wiki/Effects-Editor).

#### Implementation details
This editor relies on the "file debugging" feature exposed before. We also detour the `SwarmManager` that checks what `EffectDirectory` must
be used for a certian effect. When the effect ID is `_effect_editor`, we force a reload of the `main.effdir` file that is generated by
SporeModder FX when using the effects editor there.

The effects editor mode itself is very simple. It just loads its own camera (which is a copy of the editor camera) and loads the `_effect_editor`
effect. In the `Update` method, every second, checks if `main.effdir` was modified and reloads the effect if necessary.

## Anim Editor
Similar to the effects editor, this one is to edit creature animations in real time. You can access it with the cheat `animEditor`. Just edit the `Animation Editor` file on SporeModderFX and you will see the changes in real time. Check [the animation tutorial](https://github.com/emd4600/SporeModder-FX/wiki/Exporting-creature-animations-from-Blender) for more information.

![](https://i.imgur.com/TUdTBXq.gif)

## Part Thumbnail Capture

This mod also includes a cheat tht lets you create thumbnails for your custom parts that fit perfectly into the part preview. For more info, [check the tutorial](https://github.com/emd4600/SporeModder-FX/wiki/How-to:-Generate-perfect-part-thumbnails).

#### Implementation details
To do that it uses
the `ThumbnailCaptureScript` class, which is many things at a time: a cheat, a renderable, an UI listener, and a message listener.

When the cheat is executed, it navigates the [Palettes hierarchy](http://davoonline.com/sporemodder/emd4600/SporeModAPI/namespace_palettes.html) to
add an UI listener (itself) to all palette items. It also adds itself as a renderable in the render layer 40, which is after everything has already been rendered.
The message listener is used to detect when the editor is exited, to remove all the UI listeners.

The UI listener just detects when the mouse enters a palette item, which is when the part preview will start displaying. It just stores in the class
which palette item is about to be previewed.

The renderable `Render` function doesn't render anything; it just waits until the UI listener has detected a previewed item, and that item has loaded its model.
Then it clears the entire screen (during the capture frame, the screen will go black) to remove any background. It renders the palette item model and uses the 
model viewer `VIEWPORT` properties to know at which screen coordinates it has been rendered. It then saves that fragment into a `.png`, having captured the first
frame of the model preview animation.
